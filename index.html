<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hand ↔ English Translator</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      font-family: monospace;
      color: white;
    }
    .side {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background-color: #696969;
      color: white;
      cursor: text;
      display: flex;
      flex-direction: column;
    }
    .side.active {
      background-color: #AED6CA;
      color: black;
    }
    .header {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #divider {
      width: 10px;
      background-color: black;
      cursor: pointer;
    }
    .content {
      flex: 1;
      outline: none;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <!-- Hand side on the LEFT -->
  <div id="left" class="side">
    <div class="header">Hand</div>
    <div id="leftContent" class="content" contenteditable="false"></div>
  </div>
  <div id="divider"></div>
  <!-- English side on the RIGHT -->
  <div id="right" class="side">
    <div class="header">English</div>
    <div id="rightContent" class="content" contenteditable="false"></div>
  </div>

  <script>
    const left = document.getElementById('left');
    const right = document.getElementById('right');
    const divider = document.getElementById('divider');
    const leftContent = document.getElementById('leftContent');
    const rightContent = document.getElementById('rightContent');

    let activeSide = null;

    // Hand → English
    const handToEnglishMap = {
      "TT": " ", "T": "", "H": "(end)", ".": ".",
      "HI": ",", "HR": "?", "HM": "!",
      "TM": "1","TMM": "2","TMMM": "3","TMMMM": "4","TMMMMM": "5",
      "TMMMMMM": "6","TMMMMMMM": "7","TMMMMMMMM": "8","TMMMMMMMMM": "9","TMI": "0",
      "HTI": "*","HII": "'","HTM": "-","HH": "+","HP": "÷",
      "M":"A","I":"B","R":"C","RR":"D","MM":"E","III":"F","IM":"G","P":"H","II":"I",
      "PRM":"J","MMM":"K","RI":"L","IR":"M","PP":"N","PR":"O","PIM":"P","IP":"Q",
      "MR":"R","MP":"S","PI":"T","PM":"U","RMI":"V","IMP":"W","PRI":"X","MI":"Y","MPI":"Z"
    };

    // English → Hand
    const englishToHandMap = {
      "A":"M","B":"I","C":"R","D":"RR","E":"MM","F":"III","G":"IM","H":"P","I":"II","J":"PRM",
      "K":"MMM","L":"RI","M":"IR","N":"PP","O":"PR","P":"PIM","Q":"IP","R":"MR","S":"MP","T":"PI",
      "U":"PM","V":"RMI","W":"IMP","X":"PRI","Y":"MI","Z":"MPI",
      "1":"TM","2":"TMM","3":"TMMM","4":"TMMMM","5":"TMMMMM","6":"TMMMMMM",
      "7":"TMMMMMMM","8":"TMMMMMMMM","9":"TMMMMMMMMM","0":"TMI",
      " ":"TT",".":"H",",":"HI","?":"HR","!":"HM","*":"HTI","'":"HII","-":"HTM","+":"HH","÷":"HP"
    };

    // Hand → English
    function handToEnglish(handText) {
      let output = "";
      let i = 0;
      while (i < handText.length) {
        let found = null;
        // longest possible match (up to 9 chars: TMMMMMMMMM)
        for (let len = 9; len >= 1; len--) {
          let seq = handText.substr(i, len);
          if (handToEnglishMap[seq] !== undefined) {
            found = seq;
            break;
          }
        }
        if (found) {
          let letter = handToEnglishMap[found];
          if (letter !== "(end)") output += letter;
          i += found.length;
        } else {
          i++; // skip unknown
        }
      }
      // Capitalize first letters after sentence breaks
      return output.replace(/(^\w|\.\s+\w)/g, c => c.toUpperCase());
    }

    // English → Hand
    function englishToHand(engText) {
      let output = "";
      for (let i = 0; i < engText.length; i++) {
        let ch = engText[i].toUpperCase();
        if (englishToHandMap[ch]) {
          output += englishToHandMap[ch];
          // insert T between letters (not before punctuation/space)
          if (i < engText.length - 1 && !" .,?!*-+'÷".includes(engText[i+1])) {
            output += "T";
          }
        }
      }
      return output;
    }

    // Set active side
    function setActive(side) {
      activeSide = side;
      if (side === 'left') {
        left.classList.add('active');
        right.classList.remove('active');
        leftContent.setAttribute("contenteditable", "true");
        rightContent.setAttribute("contenteditable", "false");
        leftContent.focus();
      } else if (side === 'right') {
        right.classList.add('active');
        left.classList.remove('active');
        rightContent.setAttribute("contenteditable", "true");
        leftContent.setAttribute("contenteditable", "false");
        rightContent.focus();
      } else {
        activeSide = null;
        left.classList.remove('active');
        right.classList.remove('active');
        leftContent.setAttribute("contenteditable", "false");
        rightContent.setAttribute("contenteditable", "false");
        window.getSelection().removeAllRanges();
      }
    }

    left.addEventListener('click', () => setActive('left'));
    right.addEventListener('click', () => setActive('right'));
    divider.addEventListener('click', () => setActive(null));

    // Filter input on Hand side
    leftContent.addEventListener('beforeinput', e => {
      if (activeSide !== 'left') return;
      if (e.inputType === 'insertText') {
        const char = e.data.toUpperCase();
        const allowed = ["T","I","M","R","P","H","."];
        if (!allowed.includes(char)) {
          e.preventDefault();
        } else {
          e.preventDefault(); 
          document.execCommand("insertText", false, char);
        }
      }
    });

    // Sync Hand → English
    leftContent.addEventListener('input', () => {
      if (activeSide === 'left') {
        rightContent.textContent = handToEnglish(leftContent.textContent);
      }
    });

    // Sync English → Hand
    rightContent.addEventListener('input', () => {
      if (activeSide === 'right') {
        leftContent.textContent = englishToHand(rightContent.textContent);
      }
    });
  </script>
</body>
</html>
